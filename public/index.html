<!DOCTYPE html>
<html>
<head>
    <title>Servidor Node.js</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .file-list { list-style-type: none; padding: 0; }
        .file-list li { padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
        .file-list li:last-child { border-bottom: none; }
        .btn { padding: 8px 15px; background: #4CAF50; color: white; text-decoration: none; border-radius: 4px; }
        .btn:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>Servidor funcionando correctamente</h1>
    <p>Modo: ${process.env.SERVER_MODE || 'Desconocido'}</p>
    
    <div class="section">
        <h2>Subir archivo</h2>
        <form action="/upload" method="post" enctype="multipart/form-data">
            <input type="file" name="archivo" required>
            <button type="submit" class="btn">Subir</button>
        </form>
    </div>
    
    <div class="section">
        <h2>Archivos disponibles</h2>
        <ul class="file-list" id="fileList">
            <!-- Los archivos se cargarán aquí dinámicamente -->
            <li>No hay archivos disponibles</li>
        </ul>
    </div>

    <script>
        // Función para cargar la lista de archivos
        function loadFileList() {
            fetch('/list-files')
                .then(response => response.json())
                .then(files => {
                    const fileList = document.getElementById('fileList');
                    fileList.innerHTML = '';
                    
                    if (files.length === 0) {
                        fileList.innerHTML = '<li>No hay archivos disponibles</li>';
                        return;
                    }
                    
                   // Dentro del forEach en loadFileList()
files.forEach(file => {
    const li = document.createElement('li');
    const encodedName = encodeURIComponent(file.name);
    li.innerHTML = `
        ${file.name} (${formatBytes(file.size)}) 
        <a href="/download/${encodedName}" class="btn">Descargar</a>
        <a href="/delete/${encodedName}" class="btn" style="background: #f44336;">Eliminar</a>
    `;
    fileList.appendChild(li);
}); 
                });
        }
        
        // Función para formatear bytes a KB/MB
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Cargar lista al iniciar y cada 5 segundos
        loadFileList();
        setInterval(loadFileList, 5000);
    </script>
</body>
</html>
    
